using System;
using System.Collections.Generic;
using System.Linq;
using System.Web.Mvc;
using WeinorAppServer.Model.Entities.Verkauf.NotMapped;
using WeinorWeb.Classes;

namespace WeinorWeb.Controllers
{
    public class W17GleiseController : Controller
    {
        public ActionResult Index()
        {
            return View();
        }

        /// <summary>
        /// Takes information from  databes for table
        /// </summary>
        /// <param name="belegNr">oerder number</param>
        /// <param name="posNr">Postion number</param>
        /// <returns>list of result</returns>
        public JsonResult TrasnFerDataFromDatabase(string belegNr, string posNr)
        {
            var helper = new Helper();
            var data = helper.proxy.TrasferW17GlasInfo(Convert.ToInt32(belegNr), Convert.ToInt16(posNr));
            return Json(data, JsonRequestBehavior.AllowGet);
        }

        /// <summary>
        /// Saves New Values
        /// </summary>
        /// <param name="orderNumber"></param>
        /// <param name="posNumber"></param>
        /// <param name="anzahlFlugel">Wings number</param>
        /// <param name="anzahlGleise">Glass Number</param>
        /// <returns>bool value</returns>
        public JsonResult SaveChangedPmValue(int orderNumber, short posNumber, string anzahlFlugel, string anzahlGleise)
        {
            var helper = new Helper();
            var checker1 = helper.proxy.W17glassculculate(orderNumber, posNumber,Convert.ToInt32(anzahlFlugel)); 
            if (checker1.Value == true)
            {
                var data = helper.proxy.SavePmValue(orderNumber, posNumber, anzahlFlugel, anzahlGleise);
                var belegeNr = new int[] { orderNumber };
                var posnrs = new short[] { posNumber };
                var checker = helper.serviceProxy.BerechneEShopProduktionsmerkmaleArray(belegeNr, posnrs);
                var historesave = helper.proxy.SpeichernAktionHistorie("WebExtension", "glass added", orderNumber.ToString(), posNumber.ToString());
            }
            return Json(checker1, JsonRequestBehavior.AllowGet);
        }
    }
}
